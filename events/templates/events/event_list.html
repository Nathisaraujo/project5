{% extends "base.html" %}
{% load static %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}

{% block content %}
<div class="container-fluid mt-5">
  <div class="row text-center m-5">
      <h1 class="text-uppercase">Events</h1>
      <p>Check out all of my events!<br>
        Here you'll discover all my hosted events. 
        You'll have access to event details such as the date, location, 
        and whether it's virtual or in-person. Plus, if you register on the website, 
        you can conveniently save events for future reference on your profile. 
        As a bonus, you'll receive a friendly email reminder one day before the event!
      </p>
      <hr>
      {% if events %}
        {% for event in events %}
          <div class="card-deck">
            <div class="card">
            <div class="card-body">
                <span class="text-uppercase">{{ event.title }}</span>
                <hr>
                <p><strong>Description:</strong> {{ event.description }}</p>
                <p><strong>Date and Time:</strong> {{ event.date_and_time }}</p>
                <p><strong>Location:</strong> {{ event.location }}</p>
                <p><strong>Organizer:</strong> {{ event.organizer }}</p>
                <p><strong>Time Remaining:</strong> <span id="countdown-{{ event.pk }}">{{ event.time_remaining }}</span></p>
                {% if request.user.is_authenticated %}
                  <form action="{% url 'save_event' event.id %}" method="post">
                    {% csrf_token %}
                    <button type="submit">Save Event</button>
                  </form>
                {% endif %}
            </div>
            </div>
          </div>
          {% endfor %}
      {% else %}
      <p>No events available at the moment.</p>
      {% endif %}
{% endblock %}

{% block postloadjs %}
{{ block.super }}

 <!-- Pass events variable as JSON object to JavaScript -->
 <script>
  var events = JSON.parse('{{ events_json|escapejs }}');

  // Function to update countdown timer
  function updateCountdown(eventId, eventDateTime) {
    var eventDate = new Date(eventDateTime);
    var now = new Date();
    var timeRemaining = eventDate - now;
    
    // Calculate remaining days, hours, minutes, and seconds
    var days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
    var hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
    
    // Update countdown element
    var countdownElement = document.getElementById('countdown-' + eventId);
    countdownElement.textContent = days + ' days, ' + hours + ' hours, ' + minutes + ' minutes, ' + seconds + ' seconds';
  }

  // Function to update countdown for each event
  function updateAllCountdowns() {
    for (var i = 0; i < events.length; i++) {
      var event = events[i];
      updateCountdown(event.pk, event.fields.date_and_time);
    }
  }

  // Update countdowns every second
  setInterval(updateAllCountdowns, 1000);
</script>

{% endblock %}
