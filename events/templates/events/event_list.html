{% extends "base.html" %}
{% load static %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}

{% block content %}

  <h1>Events</h1>
  
  {% if events %}
    <ul>
      {% for event in events %}
        <li>
          <h2>{{ event.title }}</h2>
          <p><strong>Description:</strong> {{ event.description }}</p>
          <p><strong>Date and Time:</strong> {{ event.date_and_time }}</p>
          <p><strong>Location:</strong> {{ event.location }}</p>
          <p><strong>Organizer:</strong> {{ event.organizer }}</p>
          
          <!-- Display time remaining as countdown -->
          <p><strong>Time Remaining:</strong> <span id="countdown-{{ event.pk }}">{{ event.time_remaining }}</span></p>
          
          <!-- Add more event information here -->
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No events available at the moment.</p>
  {% endif %}
{% endblock %}

{% block postloadjs %}
{{ block.super }}

 <!-- Pass events variable as JSON object to JavaScript -->
 <script>
  var events = JSON.parse('{{ events_json|escapejs }}');

  // Function to update countdown timer
  function updateCountdown(eventId, eventDateTime) {
    var eventDate = new Date(eventDateTime);
    var now = new Date();
    var timeRemaining = eventDate - now;
    
    // Calculate remaining days, hours, minutes, and seconds
    var days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
    var hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
    
    // Update countdown element
    var countdownElement = document.getElementById('countdown-' + eventId);
    countdownElement.textContent = days + ' days, ' + hours + ' hours, ' + minutes + ' minutes, ' + seconds + ' seconds';
  }

  // Function to update countdown for each event
  function updateAllCountdowns() {
    for (var i = 0; i < events.length; i++) {
      var event = events[i];
      updateCountdown(event.pk, event.fields.date_and_time);
    }
  }

  // Update countdowns every second
  setInterval(updateAllCountdowns, 1000);
</script>

{% endblock %}
